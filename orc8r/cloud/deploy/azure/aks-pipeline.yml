resources:
  repositories:
  - repository: Overrides
    type: github
    endpoint: bluechipalex - pat
    name: bluechipalex/magma-overrides

trigger:
- master

stages:
- stage: Configure
  jobs:
    - job: Configure
      pool:
        vmImage: 'ubuntu-latest'
      steps:
      - script: mkdir -p $(Agent.BuildDirectory)\s\magma
      - script: mkdir -p $(Agent.BuildDirectory)\s\magma-overrides
      - checkout: self
        path: s
      - checkout: Overrides
        path: overrides
      - task: Bash@3
        displayName: Script
        inputs:
          targetType: 'inline'
          script: echo "Hello!"
      - script: ls $(Build.SourcesDirectory)
      - script: ls $(Agent.BuildDirectory)
      - script: ls $(Agent.BuildDirectory)/overrides
      - script: |
          mkdir -p ~/secrets/
          cp -r $(Agent.BuildDirectory)/overrides/certs/ ~/secrets/certs/
          ls ~/secrets/certs
      - task: HelmInstaller@1
        inputs:
          helmVersionToInstall: '3.1.0'
      # - task: HelmDeploy@0
      #   inputs:
      #     connectionType: 'Azure Resource Manager'
      #     azureSubscription: 'Alex - Subscription'
      #     azureResourceGroup: 'sonar'
      #     kubernetesCluster: 'alexsonar'
      #     namespace: 'magma-stage'
      #     command: 'upgrade'
      #     chartType: 'FilePath'
      #     chartPath: 'orc8r/cloud/helm/orc8r'
      #     releaseName: 'orc8r'
      #     valueFile: 'orc8r/cloud/helm/orc8r/vals.yml'
